!function(){"use strict";var d=document,l=window.__LS_CONFIG||{},E=!!l.debug||/(?:[?&])lsm_debug=1(?:[&#]|$)/.test(location.search);function e(e){ "loading"===d.readyState?d.addEventListener("DOMContentLoaded",e,{once:!0}):e()}function t(e,t){return(t||d).querySelectorAll(e)}function n(e,t){return(t||d).querySelector(e)}function o(e){var t=d.body||d.documentElement;try{t.appendChild(e)}catch(e){}}function r(e){try{var t=new URL(e,location.origin);return t.hostname+t.pathname}catch(t){return e}}var a="lsm_first_landing";function i(e,t){var n=e.searchParams,o=n.get("utm_source")||"",r=n.get("utm_medium")||"",a=n.get("utm_campaign")||n.get("gad_campaignid")||n.get("hsa_cam")||"",i=n.get("gclid")||"",c=n.get("gbraid")||"",u=n.get("wbraid")||"",m=n.get("msclkid")||"",f=n.get("fbclid")||"",s=n.get("ttclid")||"",S="";try{S=t?new URL(t).hostname:""}catch(e){}var g=location.hostname,p=!!(i||c||u||m||f||s||/adwords|cpc|ppc|paid|pmax|sem|gads|googleads|meta|facebook|tiktok|linkedin/i.test(o+","+r)),h=!!(S&&S!==g&&/google\.|bing\.|yahoo\.|duckduckgo\.|baidu\.|yandex\./i.test(S)),v=S&&S===g,y=void 0,b=void 0;p?(y="付费投放",b=(o||"adwords")+"/"+(r||"ppc")):h?(y="自然搜索",b=S||"search"):v?(y="站内跳转",b=g):S?(y="外部推荐",b=S):(y="直接访问",b="(direct)");var L=n.get("hsa_ad")||i||m||f||s||"";return i&&!n.get("hsa_ad")&&(L="gclid:"+i.slice(-12)),{type:y,medium:b,campaign:a,adId:L}}function c(){var e=localStorage.getItem(a);if(e)try{return JSON.parse(e)}catch(e){}var t=new URL(location.href),n=i(t,d.referrer||""),o={url:location.href,urlShort:r(location.href),ts:(new Date).toISOString(),ref:d.referrer||"",type:n.type,medium:n.medium,campaign:n.campaign,adId:n.adId};try{localStorage.setItem(a,JSON.stringify(o))}catch(e){}return o}function u(){var e=c(),t=r(location.href),n=[];return n.push("—— 来源信息 ——"),n.push("来源："+e.type+(e.medium?"（"+e.medium+"）":"")),e.campaign&&n.push("活动："+e.campaign),e.adId&&n.push("广告ID："+e.adId),n.push("首落地页："+e.urlShort),n.push("当前页面："+t),n.join("\n")}function m(e){return e&&(e.classList.contains("elementor-form")||n(".elementor-field",e))}function f(e){return e&&e.classList.contains("wpcf7-form")}function s(e){if(!e)return null;var o=[].slice.call(t("textarea",e));if(o.length){var r=null,a=-1;return o.forEach(function(t){var n=(t.name||"").toLowerCase(),o=(t.id||"").toLowerCase(),i=(t.placeholder||"").toLowerCase(),c="";if(t.id){var u=e.querySelector('label[for="'+t.id+'"]');u&&(c=(u.textContent||"").toLowerCase())}var m=[n,o,i,c].join(" "),f=0;/message|content|inquiry|enquiry|remark|comment|question|desc|description|msg|note|留言|内容|咨询|询盘/.test(m)&&(f+=6),f+=Math.min(3,t.rows||4),t.required&&(f+=2),f>a&&(r=t,a=f)}),r||o[0]}var a=n('input[type="text"][name*="message" i],input[type="text"][name*="inquiry" i],input[type="text"][name*="content" i]',e);return a||null}var S=new WeakSet;function g(e,t,n){if(!E||!e)return;try{e.style.outline=t?"2px solid #20c997":"2px dashed #ff6b6b",e.style.outlineOffset="2px";var r=d.createElement("div");r.textContent=t?"LSM已适配":"LSM未适配",r.title=n||"",r.style.cssText="position:absolute;z-index:2147483647;background:"+(t?"#20c997":"#ff6b6b")+";color:#fff;font:12px/1.6 -apple-system,Segoe UI,Arial;padding:2px 6px;border-radius:12px;pointer-events:none;";var a=e.getBoundingClientRect(),i=d.createElement("div");i.style.cssText="position:fixed;left:"+Math.max(8,a.left+8)+"px;top:"+Math.max(8,a.top+8)+"px;z-index:2147483647;",i.appendChild(r),o(i),setTimeout(function(){i.remove()},4e3)}catch(e){}}function p(e){if(!e||S.has(e))return!1;var t=s(e);if(!t)return g(e,!1,"跳过：无 textarea/长文本"),!1;var n=function(){var e=u(),n=(t.value||"")+"";t.value=n+(n?"\n\n":"")+e,setTimeout(function(){try{t.value=n}catch(e){}},1200)};return e.addEventListener("submit",n,!0),S.add(e),g(e,!0,"已绑定："+(m(e)?"Elementor":"CF7/通用")+"；字段："+(t.name||t.id||t.tagName)),!0}function h(){var e=[].slice.call(t("form"));e.length&&(e.filter(m).forEach(p),e.filter(function(e){return!m(e)&&f(e)}).forEach(p),e.filter(function(e){return!m(e)&&!f(e)}).forEach(p))}var v=null;function y(){v||(v=setTimeout(function(){v=null;try{h()}catch(e){}},120))}function b(e){var t=d.createElement("div");t.textContent=e,t.style.cssText="position:fixed;right:16px;bottom:64px;background:#111;color:#fff;padding:10px 12px;border-radius:8px;font:13px/1.3 -apple-system,Segoe UI,Arial;z-index:2147483647;opacity:.98",o(t),setTimeout(function(){t.style.transition="all .3s",t.style.opacity="0",t.style.transform="translateY(8px)"},1600),setTimeout(function(){try{t.remove()}catch(e){}},2100)}e(function(){try{h()}catch(e){}try{(new MutationObserver(function(){y()})).observe(d.documentElement,{childList:!0,subtree:!0})}catch(e){}c(),E&&function(){var e=!1,t=[];function r(){var n=[].slice.call(d.querySelectorAll("form")),o=u();t=[],n.forEach(function(n){var r=s(n);if(!r)return void g(n,!1,"未找到留言字段");var a=(r.value||"")+"";r.value=a+(a?"\n\n":"")+o,t.push({el:r,old:a,form:n}),g(n,!0,"试注入")}),e=!0,b("试注入完成："+t.length+" 个表单")}function a(){t.forEach(function(e){try{e.el.value=e.old}catch(e){}e.form&&(e.form.style.outline="",e.form.style.outlineOffset="")}),t=[],e=!1,b("已撤销本次试注入")}var i=d.createElement("button");i.type="button",i.textContent="LSM 测试",i.style.cssText="position:fixed;right:16px;bottom:16px;z-index:2147483647;background:#0d6efd;color:#fff;border:none;border-radius:20px;padding:10px 14px;font:13px/1 -apple-system,Segoe UI,Arial;box-shadow:0 6px 18px rgba(0,0,0,.2);cursor:pointer;",i.addEventListener("click",function(){e?(a(),i.style.background="#0d6efd",i.textContent="LSM 测试"):(r(),i.style.background="#198754",i.textContent="撤销注入")}),o(i)}()})}();
